{
  "name": "Chatbot Automatize - DeepSeek AI",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "chatbot-automatize",
        "options": {
          "responseMode": "lastNode"
        }
      },
      "id": "webhook-trigger",
      "name": "Webhook - Recebe Mensagem",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        250,
        300
      ],
      "webhookId": "chatbot-automatize-webhook"
    },
    {
      "parameters": {
        "jsCode": "// Extrai a mensagem e contexto do request\nconst body = $input.first().json.body;\nconst message = body.message || '';\nconst productContext = body.productContext || null;\nconst sessionId = body.sessionId || 'anonymous';\n\n// Contexto base sobre os produtos\nconst productsCatalog = `\n## CAT√ÅLOGO DE PRODUTOS:\n\n### 1. Point Control (R$ 147)\n- Categoria: RH\n- Descri√ß√£o: Controle de ponto + relat√≥rios autom√°ticos\n- Para: Empresas com 5-50 funcion√°rios\n- Inclui: Workflow n8n, PDF 30 p√°ginas, 5 v√≠deos, templates\n- Funcionalidades: Registro via WhatsApp/Telegram, c√°lculo de horas extras, relat√≥rios mensais\n\n### 2. LinkedIn Pro (R$ 197)  \n- Categoria: Vendas\n- Descri√ß√£o: Prospec√ß√£o automatizada no LinkedIn\n- Para: Vendedores B2B, ag√™ncias, consultores\n- Resultado: M√©dia de 50 leads/semana\n- Inclui: Workflow n8n, 8 templates de mensagens, 50 ganchos testados\n\n### 3. Auto Post Social (R$ 127)\n- Categoria: Marketing\n- Descri√ß√£o: Agendamento e publica√ß√£o em redes sociais\n- Para: Social media managers, empreendedores\n- Publica em: Instagram, Facebook, Twitter, LinkedIn, TikTok\n- Inclui: Workflow n8n, 100 templates de posts, calend√°rio de conte√∫do\n\n### 4. Invoice Master (R$ 197)\n- Categoria: Financeiro\n- Descri√ß√£o: Emiss√£o autom√°tica de notas fiscais\n- Para: Infoprodutores, ag√™ncias, contadores\n- Funcionalidades: NF-e/NFS-e, detec√ß√£o de pagamentos, envio por email\n\n### 5. WhatsApp Atendimento Pro (R$ 167)\n- Categoria: Vendas\n- Descri√ß√£o: Chatbot + atendimento organizado por setores\n- Para: Lojas, empresas de servi√ßo\n- Funcionalidades: Menu interativo, FAQs, fila inteligente, 24/7\n\n### 6. Email Ninja (R$ 147)\n- Categoria: Marketing\n- Descri√ß√£o: Sequ√™ncias de email automatizadas\n- Para: Infoprodutores, e-commerces\n- Inclui: 30 templates, sequ√™ncias por nicho, A/B testing\n`;\n\n// Informa√ß√µes gerais\nconst generalInfo = `\n## INFORMA√á√ïES GERAIS:\n\n### Entrega:\n- 100% autom√°tica ap√≥s pagamento\n- Email com acesso em at√© 2 minutos\n- √Årea de membros com todos os arquivos\n\n### O que vem em cada produto:\n- Workflow n8n (JSON pronto para importar)\n- Guia PDF detalhado (20-35 p√°ginas)\n- V√≠deos tutoriais passo a passo\n- Templates e materiais extras\n- Suporte via Telegram por 30 dias\n\n### Garantia:\n- 7 dias incondicional\n- Devolu√ß√£o de 100% do valor\n- Sem perguntas\n\n### Suporte:\n- Grupo Telegram exclusivo (30 dias)\n- Email: suporte@automatize.com.br\n- Resposta em at√© 24h\n\n### Pagamento:\n- PIX (aprova√ß√£o instant√¢nea)\n- Cart√£o de cr√©dito\n- Boleto banc√°rio\n- Processado pela Kiwify (plataforma segura)\n\n### Sobre o n8n:\n- Plataforma de automa√ß√£o (como Zapier, mas gratuita e mais poderosa)\n- Pode usar n8n.cloud (mais f√°cil) ou self-hosted\n- N√£o precisa saber programar - √© visual (arrasta e solta)\n- Integra com 400+ aplicativos\n\n### Tempo de configura√ß√£o:\n- M√©dia: 15-30 minutos\n- V√≠deos mostram cada passo\n- Se travar, suporte ajuda\n`;\n\nreturn {\n  message,\n  productContext,\n  sessionId,\n  systemPrompt: `Voc√™ √© o assistente virtual do Automatize, um marketplace brasileiro de automa√ß√µes n8n prontas para usar.\n\nSua personalidade:\n- Amig√°vel e profissional\n- Direto e objetivo (respostas curtas, 2-4 linhas)\n- Usa emojis com modera√ß√£o\n- Fala portugu√™s brasileiro\n- Orientado a ajudar o cliente a encontrar a automa√ß√£o ideal\n\nRegras:\n1. Sempre sugira produtos relevantes quando fizer sentido\n2. Se n√£o souber algo espec√≠fico, direcione para o suporte\n3. Nunca invente informa√ß√µes sobre pre√ßos ou funcionalidades\n4. Incentive a compra de forma natural, sem ser insistente\n5. Se perguntarem sobre automa√ß√£o personalizada, mencione que fazemos sob medida\n\n${productsCatalog}\n\n${generalInfo}\n\nResponda √† pergunta do usu√°rio de forma √∫til e concisa.`\n};"
      },
      "id": "prepare-context",
      "name": "Prepara Contexto",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        470,
        300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.deepseek.com/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({\n  \"model\": \"deepseek-chat\",\n  \"messages\": [\n    { \"role\": \"system\", \"content\": $json[\"systemPrompt\"] },\n    { \"role\": \"user\", \"content\": $json[\"message\"] }\n  ],\n  \"temperature\": 0.7\n}) }}",
        "options": {}
      },
      "id": "deepseek-ai",
      "name": "DeepSeek AI - Resposta",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        690,
        300
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "SUBSTITUA_PELA_SUA_CREDENTIAL_ID_DEEPSEEK",
          "name": "DeepSeek API Key"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Extrai a resposta do DeepSeek\nconst deepseekResponse = $input.first().json;\n\n// Trata a resposta da API (formato OpenAI compatible)\nlet answer = '';\n\nif (deepseekResponse.choices && deepseekResponse.choices[0] && deepseekResponse.choices[0].message) {\n  answer = deepseekResponse.choices[0].message.content;\n} else if (deepseekResponse.error) {\n  answer = 'Erro na IA: ' + (deepseekResponse.error.message || 'Desconhecido');\n} else {\n  answer = 'Desculpe, tive um problema ao processar sua mensagem. Tente novamente.';\n}\n\n// Detecta se deve sugerir produtos\nconst suggestedProducts = [];\n// Recupera o contexto do n√≥ anterior\nconst contextNode = $('Prepara Contexto').first().json;\nconst lowerMessage = contextNode.message ? contextNode.message.toLowerCase() : '';\n\nif (lowerMessage.includes('rh') || lowerMessage.includes('ponto') || lowerMessage.includes('funcion√°rio')) {\n  suggestedProducts.push({ id: 'point-control', name: 'Point Control' });\n}\nif (lowerMessage.includes('linkedin') || lowerMessage.includes('prospec√ß√£o') || lowerMessage.includes('lead')) {\n  suggestedProducts.push({ id: 'linkedin-pro', name: 'LinkedIn Pro' });\n}\nif (lowerMessage.includes('social') || lowerMessage.includes('instagram') || lowerMessage.includes('post')) {\n  suggestedProducts.push({ id: 'auto-post-social', name: 'Auto Post Social' });\n}\nif (lowerMessage.includes('whatsapp') || lowerMessage.includes('atendimento')) {\n  suggestedProducts.push({ id: 'whatsapp-atendimento', name: 'WhatsApp Atendimento Pro' });\n}\nif (lowerMessage.includes('email') || lowerMessage.includes('newsletter')) {\n  suggestedProducts.push({ id: 'email-ninja', name: 'Email Ninja' });\n}\nif (lowerMessage.includes('nota') || lowerMessage.includes('fiscal') || lowerMessage.includes('nf')) {\n  suggestedProducts.push({ id: 'invoice-master', name: 'Invoice Master' });\n}\n\nreturn {\n  answer,\n  suggestedProducts: suggestedProducts.slice(0, 2),\n  sessionId: contextNode.sessionId,\n  timestamp: new Date().toISOString()\n};"
      },
      "id": "format-response",
      "name": "Formata Resposta",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        910,
        300
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "respond-webhook",
      "name": "Responde ao Site",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1130,
        300
      ]
    },
    {
      "parameters": {
        "resource": "record",
        "operation": "create",
        "table": "Chat Logs",
        "fields": {
          "values": [
            {
              "fieldId": "Message",
              "fieldValue": "={{ $('Prepara Contexto').first().json.message }}"
            },
            {
              "fieldId": "Response",
              "fieldValue": "={{ $json.answer }}"
            },
            {
              "fieldId": "Session ID",
              "fieldValue": "={{ $json.sessionId }}"
            },
            {
              "fieldId": "Timestamp",
              "fieldValue": "={{ $json.timestamp }}"
            }
          ]
        }
      },
      "id": "save-airtable",
      "name": "Salva no Airtable (Opcional)",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        910,
        500
      ],
      "disabled": true,
      "credentials": {
        "airtableTokenApi": {
          "id": "SUBSTITUA_PELA_SUA_CREDENTIAL_ID",
          "name": "Airtable Token"
        }
      },
      "notes": "Desativado por padr√£o. Ative e configure para salvar logs das conversas."
    },
    {
      "parameters": {
        "chatId": "SEU_CHAT_ID_TELEGRAM",
        "text": "üí¨ Nova pergunta no chatbot:\n\n*Pergunta:* {{ $('Prepara Contexto').first().json.message }}\n\n*Resposta:* {{ $json.answer }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "notify-telegram",
      "name": "Notifica Telegram (Opcional)",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1130,
        500
      ],
      "disabled": true,
      "credentials": {
        "telegramApi": {
          "id": "SUBSTITUA_PELA_SUA_CREDENTIAL_ID",
          "name": "Telegram Bot"
        }
      },
      "notes": "Desativado por padr√£o. Ative para receber notifica√ß√µes de perguntas no Telegram."
    }
  ],
  "connections": {
    "Webhook - Recebe Mensagem": {
      "main": [
        [
          {
            "node": "Prepara Contexto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepara Contexto": {
      "main": [
        [
          {
            "node": "DeepSeek AI - Resposta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DeepSeek AI - Resposta": {
      "main": [
        [
          {
            "node": "Formata Resposta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formata Resposta": {
      "main": [
        [
          {
            "node": "Responde ao Site",
            "type": "main",
            "index": 0
          },
          {
            "node": "Salva no Airtable (Opcional)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Notifica Telegram (Opcional)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [
    {
      "name": "chatbot"
    },
    {
      "name": "automatize"
    }
  ]
}